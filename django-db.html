<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Adding a Database to a Django App | Stefan’s Blog</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Adding a Database to a Django App" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Persistent storage using a SQL-based database for Django (development and deployment on Heroku)." />
<meta property="og:description" content="Persistent storage using a SQL-based database for Django (development and deployment on Heroku)." />
<link rel="canonical" href="https://stefanbschneider.github.io/blog/django-db" />
<meta property="og:url" content="https://stefanbschneider.github.io/blog/django-db" />
<meta property="og:site_name" content="Stefan’s Blog" />
<meta property="og:image" content="https://stefanbschneider.github.io/blog/images/logos/PostgreSQL.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-01-29T00:00:00-06:00" />
<script type="application/ld+json">
{"description":"Persistent storage using a SQL-based database for Django (development and deployment on Heroku).","url":"https://stefanbschneider.github.io/blog/django-db","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://stefanbschneider.github.io/blog/django-db"},"headline":"Adding a Database to a Django App","dateModified":"2021-01-29T00:00:00-06:00","datePublished":"2021-01-29T00:00:00-06:00","image":"https://stefanbschneider.github.io/blog/images/logos/PostgreSQL.png","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://stefanbschneider.github.io/blog/feed.xml" title="Stefan's Blog" /><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RDWKTYTDBL"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-RDWKTYTDBL');
</script>


<!--for cookie banner (from websitepolicies.com)-->
<link rel="stylesheet" type="text/css" href="//wpcc.io/lib/1.0.2/cookieconsent.min.css"/><script src="//wpcc.io/lib/1.0.2/cookieconsent.min.js"></script><script>window.addEventListener("load", function(){window.wpcc.init({"border":"thin","corners":"small","colors":{"popup":{"background":"#f6f6f6","text":"#000000","border":"#555555"},"button":{"background":"#555555","text":"#ffffff"}},"position":"bottom","content":{"href":"https://www.websitepolicies.com/policies/view/2QHCZBWr","message":"This website uses cookies to ensure you get the best experience on my website."}})});</script><link rel="shortcut icon" type="image/x-icon" href="/blog/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog/">Stefan&#39;s Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog/about/">About</a><a class="page-link" href="/blog/search/">Search</a><a class="page-link" href="/blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Adding a Database to a Django App</h1><p class="page-description">Persistent storage using a SQL-based database for Django (development and deployment on Heroku).</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-01-29T00:00:00-06:00" itemprop="datePublished">
        Jan 29, 2021
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      4 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/blog/categories/#django">django</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#heroku">heroku</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#database">database</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#github">github</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#requirements">Requirements</a></li>
<li class="toc-entry toc-h1"><a href="#defining-a-model">Defining a Model</a></li>
<li class="toc-entry toc-h1"><a href="#saving-the-model-in-a-database">Saving the Model in a Database</a>
<ul>
<li class="toc-entry toc-h2"><a href="#using-the-model-in-the-django-app">Using the Model in the Django App</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#postgresql-db-on-heroku">PostgreSQL® DB on Heroku</a></li>
<li class="toc-entry toc-h1"><a href="#what-next">What Next?</a></li>
</ul><p>Most Django apps store and work with data, e.g., entered by users.
Django supports multiple relational databases for persistent storage of such data out of the box.
In this blog post, I show how to a database to a Django app.
For local development, I use the default <a href="https://www.sqlite.org/index.html">SQLite</a> database and for production 
deployment on <a href="https://dashboard.heroku.com/">Heroku</a>, I use <a href="https://www.postgresql.org/">PostgreSQL®</a> <sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup>.</p>

<p>I use the <a href="https://stefanbschneider.github.io/blog/django-heroku">Django “Hello World” App</a> as simple example.
I add a button that users can click to say “Hello World!” and count how often it was clicked.
The number of clicks is stored in a database and displayed in the app.</p>

<p>The whole process is very simple as Django does most of the work in the background: Creating the database, making the queries, etc.</p>

<h1 id="requirements">
<a class="anchor" href="#requirements" aria-hidden="true"><span class="octicon octicon-link"></span></a>Requirements</h1>

<ul>
  <li>A Django app. For example, the Django “Hello World” App.
    <ul>
      <li>
<a href="https://github.com/stefanbschneider/django-hello-world">GitHub repository</a>. This blog post corresponds to <a href="https://github.com/stefanbschneider/django-hello-world/releases/tag/v1.2.0">release v1.2</a>.</li>
      <li><a href="https://stefanbschneider.github.io/blog/django-heroku">Initial blog post on building and deploying the Django app on Heroku</a></li>
    </ul>
  </li>
  <li>For automated deployment, a free <a href="https://dashboard.heroku.com/">Heroku</a> and <a href="https://github.com/">GitHub</a> account.</li>
</ul>

<h1 id="defining-a-model">
<a class="anchor" href="#defining-a-model" aria-hidden="true"><span class="octicon octicon-link"></span></a>Defining a Model</h1>

<p>Django defines types of data as <a href="https://docs.djangoproject.com/en/3.1/topics/db/models/">models</a>.
Instances of these models are then saved in a database, where the attributes correspond to the database table’s columns and the instances to the rows.</p>

<p>In this example, I just want to save the value of a counter. 
I define a counter by a name (in case I want to distinguish multiple counters) and a value in <code class="language-plaintext highlighter-rouge">helloworld/models.py</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>


<span class="k">class</span> <span class="nc">Counter</span><span class="p">(</span><span class="n">models</span><span class="p">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">f"</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">value</span><span class="si">}</span><span class="s">"</span>
</code></pre></div></div>

<h1 id="saving-the-model-in-a-database">
<a class="anchor" href="#saving-the-model-in-a-database" aria-hidden="true"><span class="octicon octicon-link"></span></a>Saving the Model in a Database</h1>

<p>When developing locally, Django automatically creates a SQLite <code class="language-plaintext highlighter-rouge">db.sqlite3</code>.
To save the new model in the database and create or adjust the corresponding database tables, Django offers simple CLI commands:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python manage.py makemigrations
python manage.py migrate
</code></pre></div></div>

<p>The first command generates the code for making the necessary adjustments to the database. 
This code is stored in <code class="language-plaintext highlighter-rouge">helloworld/migrations</code> and should be committed to git.
The second command then applies the adjustments to the database.</p>

<h2 id="using-the-model-in-the-django-app">
<a class="anchor" href="#using-the-model-in-the-django-app" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using the Model in the Django App</h2>

<p>To integrate the model into the “Hello World” app, I first create a view that handles the interaction with the model.
In <code class="language-plaintext highlighter-rouge">helloworld/views.py</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Counter</span>


<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># retriever counter model instance from DB or create it if it doesn't exist yet
</span>    <span class="n">counter</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'hello-world-button'</span><span class="p">)</span>

    <span class="c1"># increment counter when a POST request arrives (from the button click)
</span>    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>
        <span class="n">counter</span><span class="p">.</span><span class="n">value</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">counter</span><span class="p">.</span><span class="n">save</span><span class="p">()</span>

    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'clicks'</span><span class="p">:</span> <span class="n">counter</span><span class="p">.</span><span class="n">value</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'helloworld/index.html'</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></div></div>

<p>This view replaces the previous <code class="language-plaintext highlighter-rouge">TemplateView</code> in the app’s URL settings (<code class="language-plaintext highlighter-rouge">helloworld/urls.py</code>):</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>


<span class="n">app_name</span> <span class="o">=</span> <span class="s">'helloworld'</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># path('', TemplateView.as_view(template_name='helloworld/index.html'), name='index'),
</span>    <span class="n">path</span><span class="p">(</span><span class="s">''</span><span class="p">,</span> <span class="n">views</span><span class="p">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'index'</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></div></div>

<p>Finally, I need to adjust the template to add a button and display the number of times it was clicked (<code class="language-plaintext highlighter-rouge">helloworld/templates/helloworld/index.html</code>):</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hello World! ({{ clicks }}x)

<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"{% url 'helloworld:index' %}"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
    {% csrf_token %}
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">name=</span><span class="s">"hello-world-button"</span><span class="nt">&gt;</span>Greet the world!<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre></div></div>

<p>When running the app, it should now look like this:</p>

<p><img src="/blog/images/django-db/django-button-clicks.png" alt="Screenshot"></p>

<p>Clicking the button should reload the page and show an increased click count (here, “2x”).
The click count should persist even when the app server is restarted or the app is updated.</p>

<p>Of course, this is super slow and just an example for illustrating persistent storage in Django.
In production, this should happen asynchronously with some frontend framework.</p>

<h1 id="postgresql-db-on-heroku">
<a class="anchor" href="#postgresql-db-on-heroku" aria-hidden="true"><span class="octicon octicon-link"></span></a>PostgreSQL® DB on Heroku</h1>

<p>The SQLite database used for local development is <a href="https://djangodeployment.com/2016/12/23/which-database-should-i-use-on-production/">not suitable for production deployment</a>.
To enable persistent storage for my “Hello World” app deployed on Heroku, I use <a href="https://www.heroku.com/postgres">Heroku’s PostgreSQL® database</a>, which is free for such small use cases.</p>

<p>For deployment, Heroku uses by default <a href="https://www.heroku.com/postgres">a free PostgreSQL® database</a>.
This database is automatically created when <a href="https://stefanbschneider.github.io/blog/django-heroku">initially setting up the Django app on Heroku</a>.
The available databases on Heroku are listed in the <a href="https://data.heroku.com/">Heroku data dashboard</a>.</p>

<p><img src="/blog/images/django-db/heroku-db.png" alt="Screenshot of Heroku dashboard" title="Screenshot of the Heroku Data dashboard."></p>

<p>If a database is already listed for the Django app, then persistent storage should work out of the box for the app once it is deployed.</p>

<h1 id="what-next">
<a class="anchor" href="#what-next" aria-hidden="true"><span class="octicon octicon-link"></span></a>What Next?</h1>

<ul>
  <li><a href="https://github.com/stefanbschneider/django-hello-world">Django “Hello World” GitHub Repository</a></li>
  <li><a href="https://django-hello-world-app.herokuapp.com/">Deployed “Hello World” App on Heroku</a></li>
</ul>

<p>Small example apps I built with Django and deployed on Heroku, using persistent storage:</p>

<ul>
  <li>Quotify: An example app showing inspirational quotes. [<a href="https://github.com/stefanbschneider/quotify">Code</a>] [<a href="https://django-quotify.herokuapp.com/">App</a>]</li>
  <li>Ideally: Organize &amp; Grow Your Ideas. [<a href="https://github.com/stefanbschneider/ideally">Code</a>] [<a href="https://ideally-app.herokuapp.com/">App</a>]</li>
  <li>FeelYa: The app that gets you! [<a href="https://github.com/stefanbschneider/feelya">Code</a>] [<a href="https://feelya-app.herokuapp.com/">App</a>]</li>
</ul>

<p>Other blog posts:</p>

<ul>
  <li><a href="https://stefanbschneider.github.io/blog/django-heroku">Related post: Building a Django App and Deploying It on Heroku</a></li>
  <li><a href="https://stefanbschneider.github.io/blog/django-google-analytics">Previous post: Adding Google Analytics to a Django App</a></li>
  <li><a href="https://stefanbschneider.github.io/blog/categories/#django">Other blog posts related to Django</a></li>
  <li><a href="https://stefanbschneider.github.io/blog/categories/#heroku">Other blog posts related to Heroku</a></li>
</ul>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p>Postgres, PostgreSQL and the Slonik Logo are trademarks or registered trademarks of the PostgreSQL Community Association of Canada, and used with their permission. <a href="#fnref:1" class="reversefootnote" role="doc-backlink">↩</a></p>
    </li>
  </ol>
</div>

  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="stefanbschneider/blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/blog/django-db" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Things I learned or want to learn.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/stefanbschneider" title="stefanbschneider"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/stefan_schn" title="stefan_schn"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
